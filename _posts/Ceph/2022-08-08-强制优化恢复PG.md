---
title: 强制优化恢复PG
date: 2022-08-08 09:25:00
tags: ["存储", "Ceph"]
categories: ["Ceph"]
render_with_liquid: false
permalink: /posts/2022-08-08-强制优化恢复PG/
---

本文档介绍 Ceph 中强制恢复和回填 PG（Placement Group）的方法。

## Force Recovery/Backfill PG

在一般运维大规模 Ceph 集群中，碰到故障或者扩容通常需要 recovery 或者 backfill，而且一些特别的 PG 可能正好拥有一些重要的数据，迫切需要可用。因此，Ceph 增加了 `ceph pg force-recovery` 和 `ceph pg force-backfill` 命令允许用户强制优先恢复某个 PG。

同时也提供了 `pg cancel-force-recovery` 和 `pg cancel-force-backfill` 来取消某一个 PG 的强制命令。

## 使用方法

### 强制恢复 PG

```bash
ceph pg force-recovery <pg-id>

```

### 强制回填 PG

```bash
ceph pg force-backfill <pg-id>

```

### 取消强制恢复

```bash
ceph pg cancel-force-recovery <pg-id>

```

### 取消强制回填

```bash
ceph pg cancel-force-backfill <pg-id>

```

## 注意事项

这个愿景虽然不错，但是还是很难让用户选择哪个 PG 需要优先调度，哪个不需要。不管是对象还是块而言，都是哈希到整个集群，基本上很难确定数据分片情况，因此，这个命令对于绝大部分用户应该意义不是很大。