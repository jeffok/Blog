---
title: linux常用方法
date: 2022-09-12 08:00:00
tags: ["系统", "Linux", "OpenStack", "Nova"]
categories: ["Linux"]
render_with_liquid: false
permalink: /posts/2022-09-12-linux常用方法/
---

本文档介绍 linux常用方法 的相关内容。

## 内存统计

```bash
sar -r 1 2

Linux 2.6.32-220.el6.x86_64 (node110) 11/23/2014 _x86_64_ (1 CPU)

08:49:53 PM kbmemfree kbmemused %memused kbbuffers kbcached kbcommit %commit
08:49:54 PM 106884 1948156 94.80 180636 1342156 905972 12.41
08:49:55 PM 106884 1948156 94.80 180636 1342156 905972 12.41
Average: 106884 1948156 94.80 180636 1342156 905972 12.41

Report memory utilization statistics. The following values are displayed:
kbmemfree:可用内存量(KB)
kbmemused:已经使用的内存量(KB),不包含kernel的使用量;
%memused:内存使用百分比;
kbbuffers:buffer占用的大小(KB)
kbcached:cache占用的的内存(KB);
kbcommit:在当前负载情况下预计实际需要的内存(KB)，确保不内存溢出;(重点就在最后这两列，超过当前实际内存需要考虑优化或扩容)
%commit:按照当前的负载来看实际需要的内存(和当前的实际virtual内存对比,百分比)，如果大于100%是因为the kernel usually overcommits memory.

```

## swap统计

```json
[root@node110 sa]# sar -B 1 3
Linux 2.6.32-220.el6.x86_64 (node110) 11/23/2014 _x86_64_ (1 CPU)

09:20:40 PM pgpgin/s pgpgout/s fault/s majflt/s pgfree/s pgscank/s pgscand/s pgsteal/s %vmeff
09:20:41 PM 0.00 35.64 37.62 0.00 74.26 0.00 0.00 0.00 0.00
09:20:42 PM 0.00 16.16 38.38 0.00 77.78 0.00 0.00 0.00 0.00
09:20:43 PM 0.00 0.00 37.37 0.00 83.84 0.00 0.00 0.00 0.00
Average: 0.00 17.39 37.79 0.00 78.60 0.00 0.00 0.00 0.00
pgpgin/s:从磁盘换入内存的数据量(KB,内核2.2.x为块数);
pgpgout/s:从内存换出到磁盘的数据量(KB,内核2.2.x为块数);
fault/s:系统每秒产生的缺页(主+次)，次缺页中断不会产生IO，其实不用过于关心此值
majflt/s:系统每秒出现的主缺页中断，会产生IO，过多的主缺页中断说明内存不足
pgfree/s:free list上每秒的页数
pgscank/s:kswapd进程每秒扫描的页数
pgscand/s:每秒直接扫描的页数
pgsteal/s:因进程需要消耗内存而从cache中调用的页数;
%vmeff:通过pgsteal除以pgscan得到的值，表示重新分配的效率(即扫描了x页才得到steal的内存)。越接近100%越好，当没有发生scan的时候为0

```

## 磁盘信息统计tps

```json
[root@node110 sa]# sar -d 1 2
Linux 2.6.32-220.el6.x86_64 (node110) 11/23/2014 _x86_64_ (1 CPU)

10:17:56 PM DEV tps rd_sec/s wr_sec/s avgrq-sz avgqu-sz await svctm %util
10:17:57 PM dev11-0 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
...
10:17:57 PM dev253-1 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
[root@node110 sa]# sar -d -p 1 2
Linux 2.6.32-220.el6.x86_64 (node110) 11/23/2014 _x86_64_ (1 CPU)

10:17:41 PM DEV tps rd_sec/s wr_sec/s avgrq-sz avgqu-sz await svctm %util
10:17:42 PM scd0 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
...
10:17:42 PM datavg-strips 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00

Average: DEV tps rd_sec/s wr_sec/s avgrq-sz avgqu-sz await svctm %util
Average: scd0 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
...
Average: datavg-strips 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00

tps:每秒发生IO的次数
rd_sec/s:每秒读取的磁道(每个磁道512 byte)数
wr_sec/s:每秒写的磁道(每个磁道512 byte)数
avgrq-sz:请求的平均大小(磁道数)
avgqu-sz:请求的平均队列大小
await:IO请求被处理的平均时间(ms),包含等待时间和svctm
svctm:设备的实际服务时间(ms)
%util:写入磁盘占用的IO请求总共CPU时间，接近100%说明设备的负载满

```

## 查看硬件信息物理机虚拟机UUID

```bash
查看主板型号：
sudo  dmidecode |grep -A16 "System Information$"
dmidecode -s system-uuid
  bios-vendor
  bios-version
  bios-release-date
  system-manufacturer
  system-product-name
  system-version
  system-serial-number
  system-uuid
  baseboard-manufacturer
  baseboard-product-name
  baseboard-version
  baseboard-serial-number
  baseboard-asset-tag
  chassis-manufacturer
  chassis-type
  chassis-version
  chassis-serial-number
  chassis-asset-tag
  processor-family
  processor-manufacturer
  processor-version
  processor-frequency

内存槽及内存条：
sudo  dmidecode |grep -A16 "Memory Device$"

// 获得CPU ID
dmidecode -t 4 | grep ID |sort -u |awk -F': ' '{print $2}'

// 获得磁盘ID
fdisk -l |grep "Disk identifier" |awk {'print $3'}

查看CPU信息
cat /proc/cpuinfo

显示当前硬件信息
sudo lshw

获取CPU序列号或者主板序列号

# CPU ID

sudo dmidecode -t 4 | grep ID

# Serial Number

sudo dmidecode  | grep  Serial

# CPU

sudo dmidecode -t 4

# BIOS

sudo dmidecode -t 0

# 主板：

sudo dmidecode -t 2

# OEM:

sudo dmidecode -t 11

显示当前内存大小
free -m |grep "Mem" | awk '{print $2}'

查看硬盘温度
sudo apt-get install hddtemp
sudo hddtemp /dev/sda

```

## Linux 代理设置与取消

```ini
export http_proxy=1.2.3.4:44367
或：
export https_proxy=1.2.3.4:44367

要取消该设置：
unset http_proxy
或：
unset https_proxy

```

## 查看用户状态用户锁定

```bash
# 1. 查看用户状态

pam_tally2 --user monitor

# 2. 解锁用户

pam_tally2 --user monitor --reset

# 3. 查看用户密码过期策略

chage -l monitor

# 4. 查看密码策略

cat /etc/login.defs

```

## rpm 常用命令

```bash
rpm -qpl xxx.rpm  # 查看包内容
rpm -qpi xxx.rpm   # 查看包信息
rpm -qpR xxx.rpm   # 查看包依赖
rpm -qp --scripts xxx.rpm    # 查看包中执行脚本的内容

```

## 批量远程添加定时任务crontab

```bash
echo "1 1 * * * /usr/sbin/ntpdate us.pool.ntp.org" >> /var/spool/cron/root

ansible -i zbx.ini zbx -uadmin -b -k -m shell -a "echo '*/2 * * * * /usr/bin/python /usr/local/zabbix/scripts/io_monitor_sender.py' >> /var/spool/cron/root"

```

## Centos7 根分区扩容

```bash
# 已扩容的机器需要对系统进行扩容处理。

安装包
yum install cloud-utils-growpa
growpart /dev/vda 1
xfs_growfs /

```

## 软件安装完成没有配置文件

```bash
查询配置文件是哪一个包产生的
rpm -qf /etc/nova/nova.conf

强制安装配置文件的包
yum reinstall openstack-nova-common

```

## 通过Web来管理你的Linux--Cockpit Admin Console

```bash
# centos

yum install cockpit cockpit-networkmanager cockpit-dashboard

# 安装常用

# Fedora 22/21

dnf install cockpit

# Arch Linux

yaourt cockpit

```

## 关闭并回收swap

```text
swapoff -a

```
