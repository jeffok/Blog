---
title: 升级centos7到最新稳定版本
date: 2022-07-10 16:56:00
tags: ["CentOS", "内核", "Linux"]
categories: ["Linux", "Centos7"]
render_with_liquid: false
permalink: /posts/2022-07-10-升级centos7到最新稳定版本/
---

本文档介绍 升级centos7到最新稳定版本 的相关内容。

## 各种稳定内核

```text
https://buildlogs.centos.org/c7-exp.x86_64/kernel/

```

## 检查当前安装的版本

```text
uname -sr

```

## 查看当前内核顺序

```bash
awk -F \' '$1=="menuentry " {print i++ " : " $2}' /etc/grub2.cfg

# 默认新内核是从0开始的

grep "^menuentry" /boot/grub2/grub.cfg | cut -d "'" -f2

```

## 查看当前实际启动顺序

```text
grub2-editenv list

```

## 设置默认启动

```bash
# grub2-set-default 'CentOS Linux (4.20.12-1.el7.elrepo.x86_64) 7 (Core)'

# grub2-editenv list

// saved_entry=CentOS Linux (4.20.12-1.el7.elrepo.x86_64) 7 (Core)
或

# grub2-set-default 0  // 0代表当前第一行，也就是上面的4.20.12版本那一行内容

# grub2-editenv list

saved_entry=0

```

## 安装ELRepo源

```python
rpm --import https://example.com/RPM-GPG-KEY-elrepo.org
rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm

```

## 列出可用的内核包

```bash
yum --disablerepo="*" --enablerepo="elrepo-kernel" list available

# ml stands for mainline stable

```

## 安装最新的主线稳定内核

```bash
yum --enablerepo=elrepo-kernel install kernel-ml

```

## 修改GRUB配置以使用新的内核启动系统

```bash
vim /etc/default/grub

# 设置GRUB_DEFAULT=0

GRUB_TIMEOUT=5
GRUB_DISTRIBUTOR="$(sed 's, release .*$,,g' /etc/system-release)"
GRUB_DEFAULT=0
GRUB_DISABLE_SUBMENU=true
GRUB_TERMINAL_OUTPUT="console"
GRUB_CMDLINE_LINUX="crashkernel=auto rd.lvm.lv=cl/root rhgb quiet"
GRUB_DISABLE_RECOVERY="true"

```

## 重新创建内核

```text
grub2-mkconfig -o /boot/grub2/grub.cfg

```

## 设置从新的内核启动

```text
grub2-set-default 0

```

## 重启系统，使内核生效

```text
reboot

```

## 查看当前启内核

```text
uname -a
Linux 4.14.15-1.el7.elrepo.x86_64

```

安装内核及软件包

```bash
yum remove -y kernel-headers kernel-tools kernel-tools-libs && yum install -y kernel-lt kernel-lt-devel kernel-lt-headers kernel-lt-tools kernel-lt-tools-libs gcc gcc-c++

```
