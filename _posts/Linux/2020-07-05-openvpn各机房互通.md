---
title: openvpn各机房互通
date: 2020-07-05 13:41:00
tags: ["VPN", "网络", "Linux", "OpenVPN", "系统"]
categories: ["Linux"]
render_with_liquid: false
permalink: /posts/2020-07-05-openvpn各机房互通/
---

本文档介绍 openvpn各机房互通 的相关内容。

各机房OpenVPN IP列表
北京富丰	172.16.202.112--172.16.202.148	172.16.202.13--1.2.3.4
北京兆维	192.168.247.166--192.168.247.167	192.168.247.168--1.2.3.4
北京联通	192.168.0.124--192.168.0.125	192.168.0.126--1.2.3.4
北京苏州桥	192.168.200.112--1.2.3.4

1. 南方基地
2. 北京富丰
server.conf
port 9112
proto udp
dev tun
ca /etc/openvpn/config/ca.crt
cert /etc/openvpn/config/server.crt
crl-verify /etc/openvpn/config/crl.pem
dh /etc/openvpn/config/dh2048.pem
server 10.2.0.0 1.2.3.4
ifconfig-pool-persist /etc/openvpn/config/ipp.txt
push "route 172.16.200.0 1.2.3.4"    #将本局域网网段推送给各机房客户端.
client-config-dir /etc/openvpn/config/ccd  #各机房客户端的网段配置文件目录位置.
route 192.168.247.0 1.2.3.4    #各机房客户端的网段，一个机房一行.
route 192.168.0.0 1.2.3.4
route 192.168.200.0 1.2.3.4
client-to-client
keepalive 10 120
comp-lzo
persist-key
persist-tun
status /etc/openvpn/config/openvpn-status.log
log-append /etc/openvpn/config/openvpn.log
verb 4
ccd目录：客户端网段配置文件

# 必须以证书名命名客户端网段的文件名，告诉openvpn各个机房对应客户端证书的路由：

[root@bjff-c6-openvpn-client01-202112 config]# pwd
/etc/openvpn/config

[root@bjff-c6-openvpn-client01-202112 config]# ls ccd/
bjlt-to-bjff_201512101051 bjszq-to-bjff_201512111521 bjzw-to-bjff_201512101036

[root@bjff-c6-openvpn-client01-202112 config]# cat ccd/bjlt-to-bjff_201512101051
iroute 192.168.0.0 1.2.3.4

[root@bjff-c6-openvpn-client01-202112 config]# cat ccd/bjzw-to-bjff_201512101036
iroute 192.168.247.0 1.2.3.4

[root@bjff-c6-openvpn-client01-202112 config]# cat ccd/bjzw-to-bjff_201512101036
iroute 192.168.247.0 1.2.3.4

1、启动openvpn服务端：openvpn /etc/openvpn/config/server.conf

2、开启路由转发功能：echo 1 > /proc/sys/net/ipv4/ip_forward

3、本局域网内的其他服务器添加路由到其他机房。

3. 北京兆维
server.conf
port 9112
proto udp
dev tun
ca /etc/openvpn/config/ca.crt
cert /etc/openvpn/config/server.crt
crl-verify /etc/openvpn/config/crl.pem
dh /etc/openvpn/config/dh2048.pem
server 10.3.0.0 1.2.3.4
ifconfig-pool-persist /etc/openvpn/config/ipp.txt
push "route 192.168.247.0 1.2.3.4"    #将本局域网网段推送给各机房客户端.
client-config-dir /etc/openvpn/config/ccd   #各机房客户端的网段配置文件目录位置.
route 192.168.0.0 1.2.3.4    #各机房客户端的网段，一个机房一行.
route 192.168.200.0 1.2.3.4
client-to-client
keepalive 10 120
comp-lzo
persist-key
persist-tun
status /etc/openvpn/config/openvpn-status.log
log-append /etc/openvpn/config/openvpn.log
verb 4
ccd目录：客户端网段配置文件

# 必须以证书名命名客户端网段的文件名，告诉openvpn各个机房对应客户端证书的路由：

[root@zwjf-openvpn01-247166 openvpn]# pwd
/etc/openvpn

[root@zwjf-openvpn01-247166 openvpn]# ls config/ccd/
bjlt-to-bjzw_201512101058 bjszq-to-bjzw_201512151022

[root@zwjf-openvpn01-247166 openvpn]# cat config/ccd/bjlt-to-bjzw_201512101058
iroute 192.168.0.0 1.2.3.4

[root@zwjf-openvpn01-247166 openvpn]# cat config/ccd/bjszq-to-bjzw_201512151022
iroute 192.168.200.0 1.2.3.4
北京富丰客户端证书：client.conf

# 连接北京富丰openvpn服务端的client证书：

client
dev tun
proto udp
remote 1.2.3.4 9112
resolv-retry infinite
nobind
persist-key
persist-tun
remote-cert-tls server
comp-lzo
verb 3
....

# 以下是证书密钥....

1、启动openvpn服务端：openvpn /etc/openvpn/config/server.conf

2、启动openvpn连接富丰机房：openvpn /etc/openvpn/client/bjzw-to-bjff.ovpn

3、开启路由转发功能：echo 1 > /proc/sys/net/ipv4/ip_forward

4、本局域网内的其他服务器添加路由到其他机房。

4. 北京联通
server.conf
port 9112
proto udp
dev tun
ca /etc/openvpn/config/ca.crt
cert /etc/openvpn/config/server.crt
crl-verify /etc/openvpn/config/crl.pem
dh /etc/openvpn/config/dh2048.pem
server 10.4.0.0 1.2.3.4
ifconfig-pool-persist /etc/openvpn/config/ipp.txt
push "route 192.168.0.0 1.2.3.4"    #将本局域网网段推送给各机房客户端.
client-config-dir /etc/openvpn/config/ccd #各机房客户端的网段配置文件目录位置.
route 192.168.200.0 1.2.3.4    #各机房客户端的网段.
client-to-client
keepalive 10 120
comp-lzo
persist-key
persist-tun
status /etc/openvpn/config/openvpn-status.log
log-append /etc/openvpn/config/openvpn.log
verb 4
ccd目录：客户端网段配置文件

# 必须以证书名命名客户端网段的文件名，告诉openvpn各个机房对应客户端证书的路由：

[root@bjunicom-openvpn01-0124 openvpn]# pwd
/etc/openvpn

[root@bjunicom-openvpn01-0124 openvpn]# ls config/ccd/
bjszq-to-bjlt_201512151039

[root@bjunicom-openvpn01-0124 openvpn]# cat config/ccd/bjszq-to-bjlt_201512151039
iroute 192.168.200.0 1.2.3.4
北京富丰客户端证书：client.conf

# 连接北京富丰openvpn服务端的client证书：

client
dev tun
proto udp
remote 1.2.3.4 9112
resolv-retry infinite
nobind
persist-key
persist-tun
remote-cert-tls server
comp-lzo
verb 3
....

# 以下是证书密钥....

北京兆维客户端证书：client.conf

# 连接北京兆维openvpn服务端的client证书：

client
dev tun
proto udp
remote 1.2.3.4 9112
resolv-retry infinite
nobind
persist-key
persist-tun
remote-cert-tls server
comp-lzo
verb 3
....

# 以下是证书密钥....

1、启动openvpn服务端：openvpn /etc/openvpn/config/server.conf

2、启动openvpn连接富丰机房：openvpn /etc/openvpn/client/bjlt-to-bjff.ovpn

3、启动openvpn连接兆维机房：openvpn /etc/openvpn/client/bjlt-to-bjzw.ovpn

4、开启路由转发功能：echo 1 > /proc/sys/net/ipv4/ip_forward

5、本局域网内的其他服务器添加路由到其他机房。

5. 北京苏州桥
北京富丰客户端证书：client.conf

# 连接北京富丰openvpn服务端的client证书：

client
dev tun
proto udp
remote 1.2.3.4 9112
resolv-retry infinite
nobind
persist-key
persist-tun
remote-cert-tls server
comp-lzo
verb 3
....

# 以下是证书密钥....

北京兆维客户端证书：client.conf

# 连接北京兆维openvpn服务端的client证书：

client
dev tun
proto udp
remote 1.2.3.4 9112
resolv-retry infinite
nobind
persist-key
persist-tun
remote-cert-tls server
comp-lzo
verb 3
....

# 以下是证书密钥....

北京联通客户端证书：client.conf

# 连接北京联通openvpn服务端的client证书：

client
dev tun
proto udp
remote 1.2.3.4 9112
resolv-retry infinite
nobind
persist-key
persist-tun
remote-cert-tls server
comp-lzo
verb 3
....

# 以下是证书密钥....

1、启动openvpn连接富丰机房：openvpn /etc/openvpn/client/bjszq-to-bjff.ovpn

2、启动openvpn连接兆维机房：openvpn /etc/openvpn/client/bjszq-to-bjzw.ovpn

3、启动openvpn连接联通机房：openvpn /etc/openvpn/client/bjszq-to-bjlt.ovpn

4、开启路由转发功能：echo 1 > /proc/sys/net/ipv4/ip_forward

5、本局域网内的其他服务器添加路由到其他机房。