---
title: nginx tcp 443支持多域名监听
date: 2022-07-13 13:29:00
tags: ["Nginx", "Web服务器"]
categories: ["SoftWare", "Nginx"]
render_with_liquid: false
permalink: /posts/2022-07-13-nginx-tcp-443支持多域名监听/
---
https://www.jianshu.com/p/dd2307a6bf02

```text
stream {
    map $ssl_preread_server_name $backend_name {
        gitea.example.com web;
        gitea.example.com/trojan trojan;
        default web;
    }

    upstream web {
        server 127.0.0.1:6443;
    }

    upstream trojan {
        server 127.0.0.1:9443;
    }

    server {
        listen 443 reuseport;
        listen [::]:443 reuseport;
        proxy_pass  $backend_name;
        ssl_preread on;
    }
}

```
