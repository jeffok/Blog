---
title: nginx转发
date: 2024-08-18 12:16:00
tags: ["DNS", "Nginx", "Web服务器", "网络"]
categories: ["SoftWare", "Nginx"]
render_with_liquid: false
permalink: /posts/2024-08-18-nginx转发/
---

本文档介绍 nginx转发 的相关内容。

## http转发

```nginx
upstream bjdz-monitor {
        server  172.19.33.12:11180  max_fails=3 fail_timeout=10s;
}

    server {
        listen 80;
        server_name bjdz-monitor.example.com;

        location / {
            proxy_pass http://bjdz-monitor;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Is-EDU   1;
            access_log  logs/bjdz-monitor_access.log main;
            error_log logs/bjdz-monitor_error.log ;
        }
    }

```

## tcp转发

```nginx
stream {
    upstream proxy_card {
        # simple round-robin  转发IP和端口
        server 192.168.1.12:12340;
    }
    server {
        listen 12340; #监听端口
        proxy_pass proxy_card;  #转发请求
    }
}

```

## udp转发

```nginx
stream {
    upstream dns {
    server 192.168.0.1:53;
    server dns.example.com:53;
    }
    server {
        listen 127.0.0.1:53 udp;
        proxy_responses 1;
        proxy_timeout 20s;
        proxy_pass dns;
        }
    }

```
